<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¾é£Ÿæ¨è–¦å™¨</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #fff8f0;
    color: #4a3b2c;
    margin: 0;
    padding: 0;
  }

  .hero {
    background-image: url("https://img.freepik.com/premium-vector/food-pattern-seamless_534604-531.jpg");
    background-size: cover;
    background-position: center;
    color: #fff8f0;
    text-align: center;
    padding: 4rem 1rem;
    position: relative;
  }

  .hero::after {
    content: "";
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(245, 139, 84, 0.3);
    z-index: 0;
  }

  .hero h1 {
    position: relative;
    z-index: 1;
    font-size: 2.8rem;
    letter-spacing: 0.05em;
    font-weight: 700;
    color: #fff8f0;
    margin: 0;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.1);
  }

  /* ===== ç™»å…¥å€ ===== */
  #loginArea {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 10;
    background: #f4c095;
    padding: 5px 10px;
    border-radius: 8px;
    border: 1px solid #f58b54;
    font-family: 'Noto Sans TC', sans-serif;
  }
  #loginBtn {
    margin-left: 10px;
    padding: 2px 6px;
    background: #f58b54;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  /* ===== ç•™è¨€å€ ===== */
  section {
    padding: 2rem;
    max-width: 700px;
    margin: 2rem auto;
    background: #fff0e6;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(245, 139, 84, 0.15);
    border: 1px solid #f4c095;
  }

  h2 {
    text-align: center;
    color: #f58b54;
    border-bottom: 2px solid #f58b54;
    padding-bottom: 0.5rem;
  }

  #searchArea input {
    padding: 5px;
    width: 250px;
    margin-right: 10px;
  }

  #reviewArea {
    margin-top: 20px;
  }

  .rating-group {
    margin-bottom: 10px;
  }

  .rating-row {
    margin-bottom: 5px;
  }

  .stars span {
    font-size: 24px;
    cursor: pointer;
    color: lightgray;
    transition: color 0.2s;
  }

  .stars span:hover,
  .stars span:hover ~ span {
    color: gold;
  }

  textarea {
    width: 100%;
    height: 80px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #f4c095;
    padding: 8px;
    font-size: 1rem;
    background: #fff8f0;
    color: #4a3b2c;
  }

  button {
    background-color: #f58b54;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 700;
    transition: 0.3s;
    border-radius: 8px;
    padding: 8px 16px;
  }

  button:hover {
    background-color: #f79465;
  }

  #reviewsUl li {
    margin-bottom: 10px;
  }

  #reviewsUl button {
    margin-left: 10px;
    cursor: pointer;
  }
</style>
</head>

<body>
<!-- ç™»å…¥å€ -->
<div id="loginArea">
  <span id="welcomeText">æœªç™»å…¥</span>
  <button id="loginBtn">ç™»å…¥</button>
</div>

<!-- æ¨™é¡Œ -->
<div class="hero"><h1>ç¾é£Ÿæ¨è–¦å™¨</h1></div>

<!-- ç•™è¨€å€ -->
<section id="content">
  <h2>ç¶²å‹ç•™è¨€å€</h2>

  <!-- ğŸ” æœå°‹é¤å»³ -->
  <div id="searchArea">
    <input type="text" id="searchRestaurant" placeholder="è¼¸å…¥é¤å»³åç¨±ï¼Œä¾‹å¦‚ï¼šé˜¿å®—éºµç·š">
    <button id="searchBtn">æœå°‹è©•è«–</button>
  </div>

  <!-- âœï¸ ç•™è¨€è¼¸å…¥å€ -->
  <div id="reviewArea" style="display:none;">
    <h3 id="currentRestaurant" style="text-align:center; color:#ff8c42;"></h3>

    <div class="rating-group">
      <div class="rating-row"><span>å£å‘³ï¼š</span><div class="stars" data-category="taste">â˜…â˜…â˜…â˜…â˜…</div></div>
      <div class="rating-row"><span>æœå‹™ï¼š</span><div class="stars" data-category="service">â˜…â˜…â˜…â˜…â˜…</div></div>
      <div class="rating-row"><span>ç’°å¢ƒï¼š</span><div class="stars" data-category="environment">â˜…â˜…â˜…â˜…â˜…</div></div>
      <div class="rating-row"><span>åƒ¹ä½ï¼š</span><div class="stars" data-category="price">â˜…â˜…â˜…â˜…â˜…</div></div>
    </div>

    <textarea id="commentInput" placeholder="è¼¸å…¥æ‚¨çš„ç”¨é¤å¿ƒå¾—..."></textarea>
    <button id="submitReview">é€å‡ºè©•è«–</button>

    <div id="reviewList">
      <h3>ğŸŠ ç¶²å‹ç•™è¨€</h3>
      <ul id="reviewsUl"></ul>
    </div>
  </div>
</section>

<script>
let registeredUsers = JSON.parse(localStorage.getItem("registeredUsers")) || [];
// ===== ç™»å…¥åŠŸèƒ½ =====
let currentUser = null;
let loggedIn = false;
const loginBtn = document.getElementById('loginBtn');
const welcomeText = document.getElementById('welcomeText');

loginBtn.onclick = () => {
  if (!loggedIn) {
    const name = prompt("è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±ï¼š");
    if (!name) return;

    // æª¢æŸ¥æ˜¯å¦é‡è¤‡
    if (registeredUsers.includes(name)) {
      alert("æ­¤åç¨±å·²è¢«ä½¿ç”¨ï¼Œè«‹æ›ä¸€å€‹ï¼");
      return;
    }

    // è¨»å†Šæ–°ä½¿ç”¨è€…
    registeredUsers.push(name);
    localStorage.setItem("registeredUsers", JSON.stringify(registeredUsers));

    // è¨­å®šç™»å…¥
    loggedIn = true;
    currentUser = name;
    welcomeText.textContent = `æ‚¨å¥½, ${name}`;
    loginBtn.textContent = "ç™»å‡º";

  } else {
    loggedIn = false;
    welcomeText.textContent = "æœªç™»å…¥";
    loginBtn.textContent = "ç™»å…¥";
    
    alert("å·²ç™»å‡º");
    currentUser = null;
  }
};


// ===== æœå°‹é¤å»³èˆ‡ç•™è¨€åŠŸèƒ½ =====
const searchBtn = document.getElementById("searchBtn");
const reviewArea = document.getElementById("reviewArea");
const currentRestaurant = document.getElementById("currentRestaurant");
const reviewsUl = document.getElementById("reviewsUl");

searchBtn.onclick = () => {
  const restaurantName = document.getElementById("searchRestaurant").value.trim();
  if (!restaurantName) return alert("è«‹è¼¸å…¥é¤å»³åç¨±");

  currentRestaurant.innerText = restaurantName;
  reviewArea.style.display = "block";

  const reviews = JSON.parse(localStorage.getItem(restaurantName)) || [];
  renderReviews(reviews, restaurantName);

  document.querySelectorAll(".stars").forEach(starDiv => {
    starDiv.innerHTML = "â˜…â˜…â˜…â˜…â˜…".split("").map((_, i) => `<span data-index="${i}">â˜…</span>`).join("");
  });
  document.getElementById("commentInput").value = "";
  initStarClicks();
};

function initStarClicks() {
  document.querySelectorAll(".stars").forEach(starDiv => {
    const spans = starDiv.querySelectorAll("span");
    spans.forEach(s => s.style.color = "lightgray");
    spans.forEach(span => {
      span.onclick = () => {
        const index = parseInt(span.dataset.index);
        spans.forEach((s, i) => {
          s.style.color = i <= index ? "gold" : "lightgray";
        });
      };
    });
  });
}

function renderReviews(reviews, restaurantName) {
  reviewsUl.innerHTML = "";

  if (reviews.length === 0) {
    const li = document.createElement("li");
    li.innerText = "ç›®å‰å°šç„¡ç•™è¨€";
    reviewsUl.appendChild(li);
    return;
  }

  reviews.forEach((r, index) => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${r.username}</strong> 
      (å£å‘³:${r.rating.taste}â­ / æœå‹™:${r.rating.service}â­ / ç’°å¢ƒ:${r.rating.environment}â­ / åƒ¹ä½:${r.rating.price}â­):
      ${r.comment}`;
    const currentName = loggedIn ? currentUser : "è¨ªå®¢";
    if (r.username === currentName) {
      const btn = document.createElement("button");
      btn.innerText = "åˆªé™¤";
      btn.onclick = () => {
        reviews.splice(index, 1);
        localStorage.setItem(restaurantName, JSON.stringify(reviews));
        renderReviews(reviews, restaurantName);
      };
      li.appendChild(btn);
    }
    reviewsUl.appendChild(li);
  });
}

const submitReview = document.getElementById("submitReview");
submitReview.onclick = () => {
  const restaurantName = currentRestaurant.innerText;
  const comment = document.getElementById("commentInput").value.trim();
  if (!comment) return alert("è«‹è¼¸å…¥ç•™è¨€å…§å®¹");

  const rating = {};
  document.querySelectorAll(".stars").forEach(starDiv => {
    const spans = starDiv.querySelectorAll("span");
    rating[starDiv.dataset.category] = Array.from(spans).filter(s => s.style.color === "gold").length;
  });

  const reviews = JSON.parse(localStorage.getItem(restaurantName)) || [];
  const currentName = loggedIn ? currentUser : "è¨ªå®¢";

  reviews.push({ username: currentName, comment, rating });
  localStorage.setItem(restaurantName, JSON.stringify(reviews));

  renderReviews(reviews, restaurantName);
  document.getElementById("commentInput").value = "";
  document.querySelectorAll(".stars span").forEach(s => s.style.color = "lightgray");
};
</script>
</body>
</html>
